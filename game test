<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>School Game Hub</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>Game Hub</h1>
    <div class="toolbar">
      <select id="gameSelect">
        <option value="snake">Snake</option>
        <option value="pong">Pong</option>
      </select>

      <button id="btnStart">Start</button>
      <button id="btnPause">Pause</button>
      <button id="btnReset">Reset</button>
    </div>
    <p class="hint" id="hint"></p>
  </header>

  <main>
    <canvas id="canvas" width="640" height="480"></canvas>
    <div class="panel">
      <div class="stat">Score: <span id="score">0</span></div>
      <div class="stat">High Score: <span id="highScore">0</span></div>
      <div class="divider"></div>
      <details>
        <summary>Controls</summary>
        <ul>
          <li><b>Snake:</b> Arrow keys / WASD</li>
          <li><b>Pong:</b> W/S (left) and ↑/↓ (right)</li>
          <li><b>Start:</b> Enter</li>
          <li><b>Pause:</b> Space</li>
          <li><b>Reset:</b> R</li>
        </ul>
      </details>
    </div>
  </main>

  <footer>
    <small>Tip: enable GitHub Pages to play from a link.</small>
  </footer>

  <script src="main.js"></script>
</body>
</html>
:root{
  --bg:#0b0f14;
  --card:#121926;
  --text:#e7eefc;
  --muted:#95a4c6;
  --accent:#6aa7ff;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background: radial-gradient(1200px 800px at 30% 10%, #12203a, var(--bg));
  color:var(--text);
}
header{
  padding:18px 16px 8px;
  max-width: 980px;
  margin: 0 auto;
}
h1{margin:0 0 10px;font-size:28px}
.toolbar{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}
select, button{
  border:1px solid rgba(255,255,255,0.12);
  background: rgba(18,25,38,0.9);
  color:var(--text);
  padding:10px 12px;
  border-radius:12px;
  font-size:14px;
}
button{
  cursor:pointer;
}
button:hover{border-color: rgba(106,167,255,0.6)}
.hint{margin:10px 0 0;color:var(--muted);font-size:14px}
main{
  max-width: 980px;
  margin: 12px auto 0;
  padding: 0 16px;
  display:grid;
  grid-template-columns: 1fr 260px;
  gap:16px;
}
canvas{
  width:100%;
  height:auto;
  border-radius:18px;
  background:#070a10;
  border:1px solid rgba(255,255,255,0.10);
  box-shadow: 0 16px 40px rgba(0,0,0,0.35);
}
.panel{
  padding:14px;
  border-radius:18px;
  background: rgba(18,25,38,0.75);
  border:1px solid rgba(255,255,255,0.10);
}
.stat{font-size:14px;color:var(--muted);margin-bottom:8px}
.stat span{color:var(--text);font-weight:700}
.divider{
  height:1px;
  background: rgba(255,255,255,0.10);
  margin:12px 0;
}
footer{
  max-width: 980px;
  margin: 14px auto 24px;
  padding: 0 16px;
  color:var(--muted);
}
@media (max-width: 860px){
  main{grid-template-columns: 1fr}
}
(() => {
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  const gameSelect = document.getElementById("gameSelect");
  const btnStart = document.getElementById("btnStart");
  const btnPause = document.getElementById("btnPause");
  const btnReset = document.getElementById("btnReset");
  const hintEl = document.getElementById("hint");
  const scoreEl = document.getElementById("score");
  const highScoreEl = document.getElementById("highScore");

  let running = false;
  let paused = false;

  // --- utilities
  const clamp = (v, a, b) => Math.max(a, Math.min(b, v));
  const randInt = (a, b) => Math.floor(a + Math.random() * (b - a + 1));

  function setHint(text) { hintEl.textContent = text; }
  function setScore(score) { scoreEl.textContent = String(score); }
  function setHighScore(key, score) {
    const hs = Math.max(Number(localStorage.getItem(key) || 0), score);
    localStorage.setItem(key, String(hs));
    highScoreEl.textContent = String(hs);
  }
  function loadHighScore(key) {
    highScoreEl.textContent = String(localStorage.getItem(key) || 0);
  }

  // --- input
  const keys = new Set();
  window.addEventListener("keydown", (e) => {
    const k = e.key.toLowerCase();

    // prevent arrow keys from scrolling
    if (["arrowup","arrowdown","arrowleft","arrowright"," "].includes(e.key.toLowerCase())) {
      e.preventDefault();
    }

    keys.add(k);

    if (k === "enter") start();
    if (k === " ") togglePause();
    if (k === "r") reset();
  });
  window.addEventListener("keyup", (e) => keys.delete(e.key.toLowerCase()));

  // --- game interface
  let game = null;

  function start() {
    if (!game) pickGame();
    running = true;
    paused = false;
  }
  function togglePause() {
    if (!running) return;
    paused = !paused;
  }
  function reset() {
    pickGame(true);
  }

  function pickGame(force = false) {
    const choice = gameSelect.value;
    running = false;
    paused = false;

    if (choice === "snake") game = makeSnake();
    if (choice === "pong") game = makePong();

    game.init(force);
    setScore(0);
    loadHighScore(game.highScoreKey);
    setHint(game.hint);
    drawFrame(); // show initial screen
  }

  gameSelect.addEventListener("change", () => pickGame(true));
  btnStart.addEventListener("click", start);
  btnPause.addEventListener("click", togglePause);
  btnReset.addEventListener("click", reset);

  // --- Snake
  function makeSnake() {
    const highScoreKey = "gamehub_snake_hs";

    const cell = 16;
    const cols = Math.floor(canvas.width / cell);
    const rows = Math.floor(canvas.height / cell);

    let dir = { x: 1, y: 0 };
    let nextDir = { x: 1, y: 0 };
    let snake = [];
    let food = { x: 10, y: 10 };
    let score = 0;
    let tick = 0;
    let tickRate = 6; // lower = faster

    function placeFood() {
      while (true) {
        const fx = randInt(1, cols - 2);
        const fy = randInt(1, rows - 2);
        const hit = snake.some(s => s.x === fx && s.y === fy);
        if (!hit) { food = { x: fx, y: fy }; return; }
      }
    }

    function init() {
      score = 0;
      tick = 0;
      tickRate = 6;
      dir = { x: 1, y: 0 };
      nextDir = { x: 1, y: 0 };
      snake = [{ x: 8, y: 8 }, { x: 7, y: 8 }, { x: 6, y: 8 }];
      placeFood();
      setScore(score);
      setHighScore(highScoreKey, 0);
    }

    function handleInput() {
      const up = keys.has("arrowup") || keys.has("w");
      const down = keys.has("arrowdown") || keys.has("s");
      const left = keys.has("arrowleft") || keys.has("a");
      const right = keys.has("arrowright") || keys.has("d");

      // prevent reversing into yourself
      if (up && dir.y !== 1) nextDir = { x: 0, y: -1 };
      else if (down && dir.y !== -1) nextDir = { x: 0, y: 1 };
      else if (left && dir.x !== 1) nextDir = { x: -1, y: 0 };
      else if (right && dir.x !== -1) nextDir = { x: 1, y: 0 };
    }

    function step() {
      handleInput();
      tick++;
      if (tick % tickRate !== 0) return;

      dir = nextDir;

      const head = snake[0];
      const newHead = { x: head.x + dir.x, y: head.y + dir.y };

      // walls
      if (newHead.x <= 0 || newHead.x >= cols - 1 || newHead.y <= 0 || newHead.y >= rows - 1) {
        gameOver();
        return;
      }
      // self-collision
      if (snake.some(s => s.x === newHead.x && s.y === newHead.y)) {
        gameOver();
        return;
      }

      snake.unshift(newHead);

      if (newHead.x === food.x && newHead.y === food.y) {
        score += 10;
        setScore(score);
        setHighScore(highScoreKey, score);
        placeFood();
        if (tickRate > 3) tickRate -= 0.25; // speed up gently
      } else {
        snake.pop();
      }
    }

    function gameOver() {
      running = false;
      setHint("Snake: Game over. Press Enter to start, R to reset.");
    }

    function draw() {
      // background
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // playfield border
      ctx.globalAlpha = 1;
      ctx.strokeStyle = "rgba(255,255,255,0.12)";
      ctx.lineWidth = 2;
      ctx.strokeRect(1, 1, canvas.width - 2, canvas.height - 2);

      // grid faint
      ctx.strokeStyle = "rgba(255,255,255,0.04)";
      ctx.lineWidth = 1;
      for (let x = 0; x < cols; x++) {
        ctx.beginPath();
        ctx.moveTo(x * cell, 0);
        ctx.lineTo(x * cell, canvas.height);
        ctx.stroke();
      }
      for (let y = 0; y < rows; y++) {
        ctx.beginPath();
        ctx.moveTo(0, y * cell);
        ctx.lineTo(canvas.width, y * cell);
        ctx.stroke();
      }

      // food
      ctx.fillStyle = "rgba(106,167,255,0.95)";
      ctx.fillRect(food.x * cell, food.y * cell, cell, cell);

      // snake
      for (let i = 0; i < snake.length; i++) {
        const s = snake[i];
        const a = 0.92 - i * 0.01;
        ctx.fillStyle = `rgba(231,238,252,${clamp(a, 0.35, 0.92)})`;
        ctx.fillRect(s.x * cell, s.y * cell, cell, cell);
      }

      if (!running) {
        overlayText("Press Enter to start");
      } else if (paused) {
        overlayText("Paused");
      }
    }

    function overlayText(text) {
      ctx.save();
      ctx.fillStyle = "rgba(0,0,0,0.5)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "rgba(231,238,252,0.95)";
      ctx.font = "bold 28px system-ui, sans-serif";
      ctx.textAlign = "center";
      ctx.fillText(text, canvas.width / 2, canvas.height / 2);
      ctx.restore();
    }

    return {
      name: "snake",
      hint: "Snake: Arrow keys/WASD. Eat squares, don’t hit walls or yourself.",
      highScoreKey,
      init,
      step,
      draw
    };
  }

  // --- Pong
  function makePong() {
    const highScoreKey = "gamehub_pong_hs";

    let score = 0;

    const paddle = {
      w: 12,
      h: 90,
      speed: 6,
      leftY: canvas.height / 2 - 45,
      rightY: canvas.height / 2 - 45
    };

    const ball = {
      x: canvas.width / 2,
      y: canvas.height / 2,
      r: 8,
      vx: 4,
      vy: 2.5
    };

    function init() {
      score = 0;
      setScore(score);
      setHighScore(highScoreKey, 0);

      paddle.leftY = canvas.height / 2 - paddle.h / 2;
      paddle.rightY = canvas.height / 2 - paddle.h / 2;

      ball.x = canvas.width / 2;
      ball.y = canvas.height / 2;
      ball.vx = Math.random() < 0.5 ? 4 : -4;
      ball.vy = (Math.random() * 2 - 1) * 3;
    }

    function step() {
      // left paddle: W/S
      if (keys.has("w")) paddle.leftY -= paddle.speed;
      if (keys.has("s")) paddle.leftY += paddle.speed;

      // right paddle: Up/Down
      if (keys.has("arrowup")) paddle.rightY -= paddle.speed;
      if (keys.has("arrowdown")) paddle.rightY += paddle.speed;

      paddle.leftY = clamp(paddle.leftY, 8, canvas.height - paddle.h - 8);
      paddle.rightY = clamp(paddle.rightY, 8, canvas.height - paddle.h - 8);

      // ball movement
      ball.x += ball.vx;
      ball.y += ball.vy;

      // top/bottom bounce
      if (ball.y - ball.r <= 6 || ball.y + ball.r >= canvas.height - 6) {
        ball.vy *= -1;
        ball.y = clamp(ball.y, 6 + ball.r, canvas.height - 6 - ball.r);
      }

      // paddle collisions
      const leftX = 18;
      const rightX = canvas.width - 18 - paddle.w;

      // left paddle
      if (ball.vx < 0 &&
          ball.x - ball.r <= leftX + paddle.w &&
          ball.y >= paddle.leftY &&
          ball.y <= paddle.leftY + paddle.h) {
        ball.vx *= -1.05;
        const hit = (ball.y - (paddle.leftY + paddle.h / 2)) / (paddle.h / 2);
        ball.vy += hit * 1.2;
        score += 1;
        setScore(score);
        setHighScore(highScoreKey, score);
      }

      // right paddle
      if (ball.vx > 0 &&
          ball.x + ball.r >= rightX &&
          ball.y >= paddle.rightY &&
          ball.y <= paddle.rightY + paddle.h) {
        ball.vx *= -1.05;
        const hit = (ball.y - (paddle.rightY + paddle.h / 2)) / (paddle.h / 2);
        ball.vy += hit * 1.2;
        score += 1;
        setScore(score);
        setHighScore(highScoreKey, score);
      }

      // out of bounds = game over
      if (ball.x < -40 || ball.x > canvas.width + 40) {
        running = false;
        setHint("Pong: Game over. Press Enter to start, R to reset.");
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // border
      ctx.strokeStyle = "rgba(255,255,255,0.12)";
      ctx.lineWidth = 2;
      ctx.strokeRect(1, 1, canvas.width - 2, canvas.height - 2);

      // center line
      ctx.strokeStyle = "rgba(255,255,255,0.08)";
      ctx.setLineDash([10, 10]);
      ctx.beginPath();
      ctx.moveTo(canvas.width / 2, 10);
      ctx.lineTo(canvas.width / 2, canvas.height - 10);
      ctx.stroke();
      ctx.setLineDash([]);

      // paddles
      ctx.fillStyle = "rgba(231,238,252,0.9)";
      ctx.fillRect(18, paddle.leftY, paddle.w, paddle.h);
      ctx.fillRect(canvas.width - 18 - paddle.w, paddle.rightY, paddle.w, paddle.h);

      // ball
      ctx.beginPath();
      ctx.fillStyle = "rgba(106,167,255,0.95)";
      ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
      ctx.fill();

      if (!running) overlayText("Press Enter to start");
      else if (paused) overlayText("Paused");
    }

    function overlayText(text) {
      ctx.save();
      ctx.fillStyle = "rgba(0,0,0,0.5)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "rgba(231,238,252,0.95)";
      ctx.font = "bold 28px system-ui, sans-serif";
      ctx.textAlign = "center";
      ctx.fillText(text, canvas.width / 2, canvas.height / 2);
      ctx.restore();
    }

    return {
      name: "pong",
      hint: "Pong: W/S for left paddle, ↑/↓ for right paddle. Don’t miss the ball.",
      highScoreKey,
      init,
      step,
      draw
    };
  }

  // --- main loop
  function drawFrame() {
    if (!game) pickGame(true);

    if (running && !paused) game.step();
    game.draw();

    requestAnimationFrame(drawFrame);
  }

  // boot
  pickGame(true);
})();
